

/***
 * @description Count size(in bytes), and lines in files and folders.
 * @constructor
 */
function LineCounter() {
    var self = this;
    var fs = require('fs');
    var path = require('path');
    var allFiles = new Array();

    /***
     * @description Fill allFiles array with all file names under currentPath - ignor folders
     * @param {string} currentPath
     * @returns {void}
     */
    var traverseFileSystem = function(currentPath) {
        var files = fs.readdirSync(currentPath);
        for (var f in files) {
            var currentFile = currentPath + '/' + files[f];
            var stats = fs.statSync(currentFile);
            if (stats.isFile())
                allFiles.push(currentFile);
            else if (stats.isDirectory())
                traverseFileSystem(currentFile);
        }
    };

    this.fileSize = function(file) {
        return fs.statSync(file)["size"];
    };

    this.directorySize = function(directory) {
        allFiles = new Array();
        traverseFileSystem(directory);

        var size = 0;
        for (var i = 0; i < allFiles.length; i++) {
            size += self.fileSize(allFiles[i]);
        }
        return size;
    };

    function getFileExtension(fileName) {
        var ext = path.extname(fileName || '').split('.');
        return ext[ext.length - 1];
    }

    this.countLinesInFile = function(file) {
        var ext = getFileExtension(file).toLowerCase();

        switch (ext) {
            // Images
            case 'bmp':
            case 'exif':
            case 'gif':
            case 'ico':
            case 'jfif':
            case 'jpeg':
            case 'pam':
            case 'pbm':
            case 'pfm':
            case 'pgm':
            case 'png':
            case 'pnm':
            case 'xcf':

            case 'raw':
            case 'tiff':
            case 'webp':
                // Others
            case 'ds_store':
            case 'gz':
            case 'class':
            case 'eot':
            case 'jar':
            case 'ttf':
            case 'woff':
                return 0;
        }
        var stats = fs.lstatSync(file);
        if (stats.isSymbolicLink())
            return 0;

        var content = fs.readFileSync(file, 'utf8');

        return content.split('/n').length;
    };

    this.countLinesInFolder = function(directory) {
        allFiles = new Array();
        traverseFileSystem(directory);

        var lines = 0;
        for (var i = 0; i < allFiles.length; i++) {
            lines += self.countLinesInFile(allFiles[i]);
        }
        return lines;
    };
}

exports.LineCounter = LineCounter;
